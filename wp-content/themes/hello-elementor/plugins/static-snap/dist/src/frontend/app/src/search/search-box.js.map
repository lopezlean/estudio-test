{"version":3,"file":"search-box.js","sourceRoot":"","sources":["../../../../../../src/frontend/app/src/search/search-box.ts"],"names":[],"mappings":"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","sourcesContent":["import { Search } from '../modules';\n\n/**\n * This class is responsible for handling the search input and displaying the search results.\n * It listens to the input event on the input element and calls the search method of the Search module.\n * It then renders the results in the searchResultsSelector element.\n * If the searchResultsSelector element is not found, it creates a new div element next to the input element.\n * The search results are rendered in this new div element.\n */\nexport default class SearchBox {\n  private selector: string;\n  private searchResultsSelector: string;\n  private elements: NodeListOf<Element> | null = null;\n  private searchModule: Search;\n\n  constructor(\n    searchModule: Search,\n    selector: string = 'input[name=\"s\"], input[name=\"q\"]',\n    searchResultsSelector: string = '.static-snap-search-results'\n  ) {\n    this.selector = selector;\n    this.searchResultsSelector = searchResultsSelector;\n    this.searchModule = searchModule;\n    document.addEventListener('DOMContentLoaded', this.initDomEvents.bind(this));\n  }\n\n  private initDomEvents = () => {\n    this.elements = document.querySelectorAll(this.selector);\n    // on press back button, get the value of q and search\n\n    this.bindEvents();\n  };\n\n  public getElements = (): HTMLInputElement[] => {\n    if (!this.elements) {\n      return [];\n    }\n    // filter elements that are in wpadminbar\n    return Array.from(this.elements).filter(\n      (element) => !element.closest('#wpadminbar')\n    ) as HTMLInputElement[];\n  };\n\n  public bindEvents = () => {\n    const elements = this.getElements();\n    elements &&\n      elements.forEach((element) => {\n        // ignore the search on wpadminbar\n\n        // if element name=s change to q\n        if (element.getAttribute('name') === 's') {\n          element.setAttribute('name', 'q');\n        }\n\n        // if have a searchParams in the url, get the value of q and search\n        const searchParams = new URLSearchParams(window.location.search);\n        const query = searchParams.get('q');\n\n        element.addEventListener('input', this.onSearch);\n        if (query) {\n          element.setAttribute('value', query);\n          element.value = query;\n          const event = new Event('input');\n          element.dispatchEvent(event);\n        }\n        // disable submit on form\n        element.closest('form')?.addEventListener('submit', (event) => {\n          event.preventDefault();\n        });\n\n        window.addEventListener('popstate', this.onPopState);\n      });\n  };\n\n  onPopState = (_event: PopStateEvent) => {\n    const searchParams = new URLSearchParams(window.location.search);\n    const query = searchParams.get('q');\n    if (query) {\n      this.getElements().forEach((element) => {\n        element.setAttribute('value', query);\n        element.value = query;\n        const event = new Event('input');\n        // if element has focus the value will not be updated\n\n        element.blur();\n\n        element.dispatchEvent(event);\n      });\n    }\n  };\n\n  onSearch = async (event: Event) => {\n    const target = event.target as HTMLInputElement;\n    if (event.isTrusted) {\n      // get input name and add searchParams to the url\n      const searchParams = new URLSearchParams(window.location.search);\n      searchParams.set('q', target.value);\n      window.history.pushState(\n        { q: target.value },\n        '',\n        `${window.location.pathname}?${searchParams.toString()}`\n      );\n    }\n\n    let renderTarget =\n      target.closest('search')?.querySelector(this.searchResultsSelector) ||\n      target.closest('form')?.querySelector(this.searchResultsSelector) ||\n      target.closest('div')?.querySelector(this.searchResultsSelector);\n\n    if (!renderTarget) {\n      // create a new div element next to the form of the input.\n      renderTarget = document.createElement('div');\n      renderTarget.className = 'static-snap-search-results';\n      const parentSearch =\n        target.closest('search') || target.closest('form') || target.closest('div');\n      if (parentSearch) {\n        parentSearch.appendChild(renderTarget);\n      } else {\n        console.error('No suitable parent found to append search results');\n        return;\n      }\n    }\n\n    const results = await this.searchModule.search(target.value);\n    this.searchModule.renderResults(renderTarget as HTMLElement, results);\n  };\n}\n"]}