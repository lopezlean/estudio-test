{"version":3,"file":"admin-loading.js","sourceRoot":"","sources":["../../../../../../src/dashboard/app/src/components/admin-loading.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect, useState } from 'react';\n\nimport Box from '@mui/material/Box';\nimport Button from '@mui/material/Button';\nimport CircularProgress, { CircularProgressProps } from '@mui/material/CircularProgress';\nimport Menu from '@mui/material/Menu';\nimport Tooltip from '@mui/material/Tooltip';\nimport Typography from '@mui/material/Typography';\nimport EnvironmentInterface from '@staticsnap/dashboard/interfaces/environment.interface';\nimport StatusInterface from '@staticsnap/dashboard/interfaces/status.interface';\nimport apiFetch from '@wordpress/api-fetch';\nimport { __ } from '@wordpress/i18n';\n\nimport DeploymentDoneDialog from './deployment-done-dialog';\nimport EnvironmentsTabs from './environments-tabs';\nimport LinearProgressWithLabel from './linear-progress-with-label';\nimport Logo from './logo';\n\ntype AdminLoadingProps = CircularProgressProps & {\n  status: StatusInterface;\n};\n\nconst AdminLoading = ({ status, ...props }: AdminLoadingProps) => {\n  const [environments, setEnvironments] = useState<EnvironmentInterface[]>([]);\n\n  const [anchorEl, setAnchorEl] = useState<null | HTMLElement>(null);\n  const open = Boolean(anchorEl);\n\n  const handleClick = useCallback((event: React.MouseEvent<HTMLButtonElement>) => {\n    setAnchorEl(event.currentTarget);\n  }, []);\n  const handleClose = useCallback(() => {\n    setAnchorEl(null);\n  }, []);\n\n  const cancelDeployment = useCallback(async () => {\n    if (!status.is_running) {\n      return;\n    }\n    await apiFetch({\n      method: 'POST',\n      path: '/static-snap/v1/deployments/cancel',\n    });\n  }, [status]);\n\n  useEffect(() => {\n    // listen to global event close menu\n    window.addEventListener('static-snap/close-deployment-menu', handleClose);\n    return () => {\n      window.removeEventListener('static-snap/close-deployment-menu', handleClose);\n    };\n  });\n\n  const TooltipTitle = status.is_running ? (\n    <Box minWidth={300}>\n      <Typography color=\"inherit\">{__('Running', 'static-snap')}</Typography>\n      <LinearProgressWithLabel\n        variant=\"determinate\"\n        value={Math.round(status.last_deployment?.status_information?.percentage || 0)}\n      />\n      <strong>{status.last_deployment?.status_information?.current_task_description}...</strong>\n      <Box sx={{ display: 'flex', justifyContent: 'center', marginTop: '8px' }}>\n        <Button sx={{ marginLeft: 'auto' }} size=\"small\" onClick={cancelDeployment} color=\"error\">\n          {__('Cancel', 'static-snap')}\n        </Button>\n      </Box>\n    </Box>\n  ) : null;\n\n  useEffect(() => {\n    const getEnvironments = async () => {\n      const response = await apiFetch({ path: '/static-snap/v1/environments' });\n      setEnvironments(Array.from(response as EnvironmentInterface[]));\n    };\n    getEnvironments();\n  }, []);\n\n  return (\n    <Tooltip title={TooltipTitle} placement=\"bottom\" arrow open={status.is_running}>\n      <Box\n        sx={{\n          display: 'inline-flex',\n          height: {\n            md: '32px !important',\n            xs: '46px !important',\n          },\n          justifyContent: 'center',\n          position: 'relative !important',\n          //width: '32px !important',\n        }}\n      >\n        <Button\n          component={'a' as React.ElementType}\n          onClick={handleClick}\n          disabled={status.is_running}\n          sx={{\n            display: 'flex !important',\n            position: 'relative !important',\n            minWidth: '32px !important',\n            // if open add wp styles\n            ...(open && {\n              background: '#2c3338 !important',\n              color: '#72aee6 !important',\n            }),\n          }}\n        >\n          {status.is_running && (\n            <CircularProgress\n              variant=\"determinate\"\n              {...props}\n              size={32}\n              color=\"primary\"\n              value={status.last_deployment?.status_information?.percentage || 0}\n              sx={{\n                circle: {\n                  transition: 'stroke-dashoffset 900ms cubic-bezier(0.4, 0, 0.2, 1) 0ms !important',\n                },\n                height: {\n                  md: '32px !important',\n                  xs: '44px !important',\n                },\n                transition: 'transform 900ms cubic-bezier(0.4, 0, 0.2, 1) 0ms !important',\n                width: {\n                  md: '32px !important',\n                  xs: '44px !important',\n                },\n              }}\n            />\n          )}\n          <Box\n            sx={{\n              alignItems: 'center',\n              bottom: 0,\n              display: 'flex',\n              justifyContent: 'center',\n              left: 0,\n              position: 'absolute !important',\n              right: 0,\n              top: 0,\n            }}\n          >\n            <Logo\n              sx={{\n                // keyframes\n                '@keyframes spin': {\n                  '0%': {\n                    transform: 'rotate(0deg)',\n                  },\n                  '100%': {\n                    transform: 'rotate(360deg)',\n                  },\n                },\n                alignItems: 'center',\n                display: 'flex',\n                inset: '0 !important',\n                justifyContent: 'center',\n                position: 'absolute !important',\n\n                svg: {\n                  // rotate animation\n                  ...(status.is_running && { animation: 'spin 2s linear infinite' }),\n                  height: {\n                    md: '22px !important',\n                    xs: '30px !important',\n                  },\n                  path: {\n                    fill: '#c3c4c7 !important',\n                  },\n\n                  width: {\n                    md: '22px !important',\n                    xs: '30px !important',\n                  },\n                },\n              }}\n            />\n          </Box>\n        </Button>\n        {!status.is_running && (\n          <Menu\n            anchorEl={anchorEl}\n            open={open}\n            onClose={handleClose}\n            elevation={9}\n            anchorOrigin={{\n              vertical: 'bottom',\n              horizontal: 'center',\n            }}\n            transformOrigin={{\n              vertical: 'top',\n              horizontal: 'center',\n            }}\n            // change ul for a div\n            MenuListProps={{\n              component: 'div',\n              sx: { paddingBottom: 0 },\n            }}\n            sx={{\n              maxWidth: '90%',\n            }}\n          >\n            <EnvironmentsTabs environments={environments} />\n          </Menu>\n        )}\n        <DeploymentDoneDialog status={status} />\n      </Box>\n    </Tooltip>\n  );\n};\n\nexport default AdminLoading;\n"]}